<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta id="theme-check" name="theme-color" content="black">
    <link rel="stylesheet" type="text/css" href="bootstrap.css">
    <link rel="stylesheet" type="text/css" href="bootstrap-icons.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover">
    <title>Karibu NaboGaming | BetPlace</title>
    <script defer type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getAuth, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC_VKdV-KsIzUiOb7jFLsYXdTsuGkLiS-Q",
            authDomain: "register-71bde.firebaseapp.com",
            projectId: "register-71bde",
            storageBucket: "register-71bde.appspot.com",
            messagingSenderId: "412548441298",
            appId: "1:412548441298:web:e0fb2b6c5fbd4af7d0b90b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Observe the user's login state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, update the UI with the user's info
                updateUserProfile(user);
                saveUserDataToDatabase(user);
                displayUserList();
            } else {
                // No user is signed in, prompt to create an account and log in
                alert("Create Account & login");
                window.location.href = "index.html";
            }
        });

        function updateUserProfile(user) {
            const userName = user.displayName;
            const userEmail = user.email;
            const userProfilePicture = user.photoURL;

            // Update the UI elements with the user's info
            document.getElementById("userName").textContent = userName;
            document.getElementById("userEmail").textContent = userEmail;
            document.getElementById("userProfilePicture").src = userProfilePicture;
        }

        function saveUserDataToDatabase(user) {
            const usersRef = ref(database, 'users/' + user.uid);
            set(usersRef, {
                name: user.displayName,
                email: user.email,
                profilePicture: user.photoURL
            });
        }

        function displayUserList() {
            const usersRef = ref(database, 'users');
            onValue(usersRef, (snapshot) => {
                const users = snapshot.val();
                const userListElement = document.getElementById("userList");
                userListElement.innerHTML = ''; // Clear the previous list

                for (let userId in users) {
                    const user = users[userId];
                    const userItem = document.createElement("li");
                    userItem.textContent = user.name;
                    userListElement.appendChild(userItem);
                }
            });
        }
    </script>
</head>
<body>
    <h1>Logged in as </h1>
    <p id="userName"></p>
    <p id="userEmail"></p>
    <img id="userProfilePicture">
    <h2>User List</h2>
    <ul id="userList"></ul>
    <script src="bootstrap.min.js"></script>
    <script src="custom.js"></script>
</body>
</html>