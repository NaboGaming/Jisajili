<!DOCTYPE html><html lang="en"><head>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta id="theme-check" name="theme-color" content="black">
    <link rel="stylesheet" type="text/css" href="bootstrap.css">
<link rel="stylesheet" type="text/css" href="bootstrap-icons.css">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover">
<title>Karibu NaboGaming | BetPlace</title>
<script defer type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC_VKdV-KsIzUiOb7jFLsYXdTsuGkLiS-Q",
        authDomain: "register-71bde.firebaseapp.com",
        projectId: "register-71bde",
        storageBucket: "register-71bde.appspot.com",
        messagingSenderId: "412548441298",
        appId: "1:412548441298:web:e0fb2b6c5fbd4af7d0b90b"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Observe the user's login state
    onAuthStateChanged(auth, (user) => {
        if (user) {
            // User is signed in, update the UI with the user's info
            updateUserProfile(user);
        } else {
            // No user is signed in, prompt to create an account and log in
            window.location.href = "index.html";
        }
    });

    function updateUserProfile(user) {
        const userName = user.displayName;
const userName2 = user.displayName;
        const userEmail = user.email;
        const userProfilePicture = user.photoURL;

        // Update the UI elements with the user's info
        document.getElementById("userName").textContent = userName;
      document.getElementById("userName2").textContent = userName2;  document.getElementById("userEmail").textContent = userEmail;
        document.getElementById("userProfilePicture").src = userProfilePicture;
    }
</script>
<script defer type="module">
const database = getDatabase(app); // Get a reference to the Firebase Realtime Database

// Function to send a message
function sendMessage() {
    const messageInput = document.getElementById("messageInput");
    const message = messageInput.value;
    const uid = getCurrentUserUid(); // Call the function to get the current user's UID
    if (uid) {
        const messageData = {
            uid: uid,
            message: message,
            timestamp: firebase.database.ServerValue.TIMESTAMP // Add a timestamp to the message
        };

        // Push the new message to the database
        push(ref(database, 'public-messages'), messageData)
            .then(() => {
                // Clear the input field after sending the message
                messageInput.value = "";
            })
            .catch((error) => {
                console.error("Error sending message: ", error);
                // Handle any errors that occur during the push operation
            });
    } else {
        // Handle the case when the user is not signed in
        console.log("User is not signed in");
    }
}

// Function to display received messages
function displayMessage(uid, message, timestamp) {
    // Here, you can format and display the received messages as per your UI requirements
    // For example, you can append the messages to the #messages div
    const messageDiv = document.createElement("div");
    messageDiv.textContent = message;
    document.getElementById("messages").appendChild(messageDiv);
}

// Function to listen for new messages in the public chat
function listenForMessages() {
    const messagesRef = ref(database, 'public-messages');
    onChildAdded(messagesRef, (snapshot) => {
        const messageData = snapshot.val();
        const { uid, message, timestamp } = messageData;
        displayMessage(uid, message, timestamp);
    });
}

// Call the function to start listening for new messages when the user is authenticated
onAuthStateChanged(auth, (user) => {
    if (user) {
        updateUserProfile(user);
        listenForMessages(); // Start listening for new messages when the user is authenticated
    } else {
        document.getElementById('customAlert').style.display = 'block';
        window.location.href = "index.html";
    }
});
<script>
</head>
<body>
    <h1>Logged in as </h1>
<p id="userName"></p>
<p id="userEmail"></p>
<img id="userProfilePicture">
<div>
    <h2>Hi,<p id="userName2"></p>Welcome to Chat Room</h2>
    <div id="messages"></div>
    <input type="text" id="messageInput" />
    <button onclick="sendMessage()">Send</button>
</div>


<script src="bootstrap.min.js"></script>
<script src="custom.js"></script>
</body></html>
